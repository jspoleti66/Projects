<!DOCTYPE html>
<html>
<head>
  <title>AlmostMe - Clon Parlante</title>
  <script src="https://unpkg.com/@d-id/talkie-player"></script>
</head>
<body>
  <h2>Tu clon digital AlmostMe</h2>
  <talkie-player
    id="clon"
    src="https://create-images-results.d-id.com/your-avatar-image.png" 
    style="width: 400px; height: 400px;"
  ></talkie-player>

  <br /><br />
  <input type="text" id="mensaje" placeholder="Escribí algo..." style="width: 300px;" />
  <button onclick="enviar()">Hablar</button>

  <script>
    const player = document.getElementById("clon");

    async function enviar() {
      const texto = document.getElementById("mensaje").value;

      const respuesta = await fetch("/clon", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ mensaje: texto })
      });

      const data = await respuesta.json();
      if (data.error) {
        alert("Error: " + data.error);
        return;
      }

      player.play({
        script: {
          type: "text",
          input: data.respuesta,
          provider: { type: "microsoft", voice_id: "es-ES-AlvaroNeural" }
        },
        config: {
          apiKey: "Y2VjYXJyaXpvZ0BnbWFpbC5jb20:KRphQ-Ulqibq5EpN8xj3f" // ⚠️ solo para pruebas locales
        }
      });
    }
  </script>
</body>
</html>
